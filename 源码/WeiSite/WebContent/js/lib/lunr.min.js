(function(){var a=function(b){var c=new a.Index;c.pipeline.add(a.trimmer,a.stopWordFilter,a.stemmer);if(b){b.call(c,c)}return c};a.version="0.6.0";a.utils={};a.utils.warn=(function(b){return function(c){if(b.console&&console.warn){console.warn(c)}}})(this);a.utils.asString=function(b){if(b===void 0||b===null){return""}else{return b.toString()}};a.EventEmitter=function(){this.events={}};a.EventEmitter.prototype.addListener=function(){var b=Array.prototype.slice.call(arguments),c=b.pop(),d=b;if(typeof c!=="function"){throw new TypeError("last argument must be a function")}d.forEach(function(e){if(!this.hasHandler(e)){this.events[e]=[]}this.events[e].push(c)},this)};a.EventEmitter.prototype.removeListener=function(d,b){if(!this.hasHandler(d)){return}var c=this.events[d].indexOf(b);this.events[d].splice(c,1);if(!this.events[d].length){delete this.events[d]}};a.EventEmitter.prototype.emit=function(c){if(!this.hasHandler(c)){return}var b=Array.prototype.slice.call(arguments,1);this.events[c].forEach(function(d){d.apply(undefined,b)})};a.EventEmitter.prototype.hasHandler=function(b){return b in this.events};a.tokenizer=function(b){if(!arguments.length||b==null||b==undefined){return[]}if(Array.isArray(b)){return b.map(function(c){return a.utils.asString(c).toLowerCase()})}return b.toString().trim().toLowerCase().split(a.tokenizer.seperator)};a.tokenizer.seperator=/[\s\-]+/;a.Pipeline=function(){this._stack=[]};a.Pipeline.registeredFunctions={};a.Pipeline.registerFunction=function(b,c){if(c in this.registeredFunctions){a.utils.warn("Overwriting existing registered function: "+c)}b.label=c;a.Pipeline.registeredFunctions[b.label]=b};a.Pipeline.warnIfFunctionNotRegistered=function(b){var c=b.label&&(b.label in this.registeredFunctions);if(!c){a.utils.warn("Function is not registered with pipeline. This may cause problems when serialising the index.\n",b)}};a.Pipeline.load=function(c){var b=new a.Pipeline;c.forEach(function(e){var d=a.Pipeline.registeredFunctions[e];if(d){b.add(d)}else{throw new Error("Cannot load un-registered function: "+e)}});return b};a.Pipeline.prototype.add=function(){var b=Array.prototype.slice.call(arguments);b.forEach(function(c){a.Pipeline.warnIfFunctionNotRegistered(c);this._stack.push(c)},this)};a.Pipeline.prototype.after=function(b,c){a.Pipeline.warnIfFunctionNotRegistered(c);var d=this._stack.indexOf(b);if(d==-1){throw new Error("Cannot find existingFn")}d=d+1;this._stack.splice(d,0,c)};a.Pipeline.prototype.before=function(b,c){a.Pipeline.warnIfFunctionNotRegistered(c);var d=this._stack.indexOf(b);if(d==-1){throw new Error("Cannot find existingFn")}this._stack.splice(d,0,c)};a.Pipeline.prototype.remove=function(b){var c=this._stack.indexOf(b);if(c==-1){return}this._stack.splice(c,1)};a.Pipeline.prototype.run=function(h){var d=[],g=h.length,e=this._stack.length;for(var b=0;b<g;b++){var f=h[b];for(var c=0;c<e;c++){f=this._stack[c](f,b,h);if(f===void 0||f===""){break}}if(f!==void 0&&f!==""){d.push(f)}}return d};a.Pipeline.prototype.reset=function(){this._stack=[]};a.Pipeline.prototype.toJSON=function(){return this._stack.map(function(b){a.Pipeline.warnIfFunctionNotRegistered(b);return b.label})};a.Vector=function(){this._magnitude=null;this.list=undefined;this.length=0};a.Vector.Node=function(b,d,c){this.idx=b;this.val=d;this.next=c};a.Vector.prototype.insert=function(b,f){this._magnitude=undefined;var c=this.list;if(!c){this.list=new a.Vector.Node(b,f,c);return this.length++}if(b<c.idx){this.list=new a.Vector.Node(b,f,c);return this.length++}var e=c,d=c.next;while(d!=undefined){if(b<d.idx){e.next=new a.Vector.Node(b,f,d);return this.length++}e=d,d=d.next}e.next=new a.Vector.Node(b,f,d);return this.length++};a.Vector.prototype.magnitude=function(){if(this._magnitude){return this._magnitude}var b=this.list,c=0,d;while(b){d=b.val;c+=d*d;b=b.next}return this._magnitude=Math.sqrt(c)};a.Vector.prototype.dot=function(e){var c=this.list,d=e.list,b=0;while(c&&d){if(c.idx<d.idx){c=c.next}else{if(c.idx>d.idx){d=d.next}else{b+=c.val*d.val;c=c.next;d=d.next}}}return b};a.Vector.prototype.similarity=function(b){return this.dot(b)/(this.magnitude()*b.magnitude())};a.SortedSet=function(){this.length=0;this.elements=[]};a.SortedSet.load=function(b){var c=new this;c.elements=b;c.length=b.length;return c};a.SortedSet.prototype.add=function(){var c,b;for(c=0;c<arguments.length;c++){b=arguments[c];if(~this.indexOf(b)){continue}this.elements.splice(this.locationFor(b),0,b)}this.length=this.elements.length};a.SortedSet.prototype.toArray=function(){return this.elements.slice()};a.SortedSet.prototype.map=function(c,b){return this.elements.map(c,b)};a.SortedSet.prototype.forEach=function(c,b){return this.elements.forEach(c,b)};a.SortedSet.prototype.indexOf=function(b){var g=0,c=this.elements.length,f=c-g,d=g+Math.floor(f/2),e=this.elements[d];while(f>1){if(e===b){return d}if(e<b){g=d}if(e>b){c=d}f=c-g;d=g+Math.floor(f/2);e=this.elements[d]}if(e===b){return d}return -1};a.SortedSet.prototype.locationFor=function(b){var g=0,c=this.elements.length,f=c-g,d=g+Math.floor(f/2),e=this.elements[d];while(f>1){if(e<b){g=d}if(e>b){c=d}f=c-g;d=g+Math.floor(f/2);e=this.elements[d]}if(e>b){return d}if(e<b){return d+1}};a.SortedSet.prototype.intersect=function(l){var h=new a.SortedSet,g=0,k=0,d=this.length,f=l.length,c=this.elements,e=l.elements;while(true){if(g>d-1||k>f-1){break}if(c[g]===e[k]){h.add(c[g]);g++,k++;continue}if(c[g]<e[k]){g++;continue}if(c[g]>e[k]){k++;continue}}return h};a.SortedSet.prototype.clone=function(){var b=new a.SortedSet;b.elements=this.toArray();b.length=b.elements.length;return b};a.SortedSet.prototype.union=function(c){var b,d,e;if(this.length>=c.length){b=this,d=c}else{b=c,d=this}e=b.clone();e.add.apply(e,d.toArray());return e};a.SortedSet.prototype.toJSON=function(){return this.toArray()};a.Index=function(){this._fields=[];this._ref="id";this.pipeline=new a.Pipeline;this.documentStore=new a.Store;this.tokenStore=new a.TokenStore;this.corpusTokens=new a.SortedSet;this.eventEmitter=new a.EventEmitter;this._idfCache={};this.on("add","remove","update",(function(){this._idfCache={}}).bind(this))};a.Index.prototype.on=function(){var b=Array.prototype.slice.call(arguments);return this.eventEmitter.addListener.apply(this.eventEmitter,b)};a.Index.prototype.off=function(c,b){return this.eventEmitter.removeListener(c,b)};a.Index.load=function(c){if(c.version!==a.version){a.utils.warn("version mismatch: current "+a.version+" importing "+c.version)}var b=new this;b._fields=c.fields;b._ref=c.ref;b.documentStore=a.Store.load(c.documentStore);b.tokenStore=a.TokenStore.load(c.tokenStore);b.corpusTokens=a.SortedSet.load(c.corpusTokens);b.pipeline=a.Pipeline.load(c.pipeline);return b};a.Index.prototype.field=function(c,d){var d=d||{},b={name:c,boost:d.boost||1};this._fields.push(b);return this};a.Index.prototype.ref=function(b){this._ref=b;return this};a.Index.prototype.add=function(c,f){var e={},b=new a.SortedSet,d=c[this._ref],f=f===undefined?true:f;this._fields.forEach(function(i){var k=this.pipeline.run(a.tokenizer(c[i.name]));e[i.name]=k;a.SortedSet.prototype.add.apply(b,k)},this);this.documentStore.set(d,b);a.SortedSet.prototype.add.apply(this.corpusTokens,b.toArray());for(var g=0;g<b.length;g++){var j=b.elements[g];var h=this._fields.reduce(function(l,i){var k=e[i.name].length;if(!k){return l}var m=e[i.name].filter(function(n){return n===j}).length;return l+(m/k*i.boost)},0);this.tokenStore.add(j,{ref:d,tf:h})}if(f){this.eventEmitter.emit("add",c,this)}};a.Index.prototype.remove=function(b,e){var c=b[this._ref],e=e===undefined?true:e;if(!this.documentStore.has(c)){return}var d=this.documentStore.get(c);this.documentStore.remove(c);d.forEach(function(f){this.tokenStore.remove(f,c)},this);if(e){this.eventEmitter.emit("remove",b,this)}};a.Index.prototype.update=function(b,c){var c=c===undefined?true:c;this.remove(b,false);this.add(b,false);if(c){this.eventEmitter.emit("update",b,this)}};a.Index.prototype.idf=function(e){var b="@"+e;if(Object.prototype.hasOwnProperty.call(this._idfCache,b)){return this._idfCache[b]}var c=this.tokenStore.count(e),d=1;if(c>0){d=1+Math.log(this.documentStore.length/c)}return this._idfCache[b]=d};a.Index.prototype.search=function(f){var g=this.pipeline.run(a.tokenizer(f)),h=new a.Vector,c=[],d=this._fields.reduce(function(j,i){return j+i.boost},0);var e=g.some(function(i){return this.tokenStore.has(i)},this);if(!e){return[]}g.forEach(function(n,j,o){var m=1/o.length*this._fields.length*d,k=this;var l=this.tokenStore.expand(n).reduce(function(u,s){var v=k.corpusTokens.indexOf(s),r=k.idf(s),z=1,y=new a.SortedSet;if(s!==n){var p=Math.max(3,s.length-n.length);z=1/Math.log(p)}if(v>-1){h.insert(v,m*r*z)}var t=k.tokenStore.get(s),w=Object.keys(t),x=w.length;for(var q=0;q<x;q++){y.add(t[w[q]].ref)}return u.union(y)},new a.SortedSet);c.push(l)},this);var b=c.reduce(function(i,j){return i.intersect(j)});return b.map(function(i){return{ref:i,score:h.similarity(this.documentVector(i))}},this).sort(function(i,j){return j.score-i.score})};a.Index.prototype.documentVector=function(b){var c=this.documentStore.get(b),d=c.length,e=new a.Vector;for(var f=0;f<d;f++){var j=c.elements[f],h=this.tokenStore.get(j)[b].tf,g=this.idf(j);e.insert(this.corpusTokens.indexOf(j),h*g)}return e};a.Index.prototype.toJSON=function(){return{version:a.version,fields:this._fields,ref:this._ref,documentStore:this.documentStore.toJSON(),tokenStore:this.tokenStore.toJSON(),corpusTokens:this.corpusTokens.toJSON(),pipeline:this.pipeline.toJSON()}};a.Index.prototype.use=function(c){var b=Array.prototype.slice.call(arguments,1);b.unshift(this);c.apply(this,b)};a.Store=function(){this.store={};this.length=0};a.Store.load=function(b){var c=new this;c.length=b.length;c.store=Object.keys(b.store).reduce(function(e,d){e[d]=a.SortedSet.load(b.store[d]);return e},{});return c};a.Store.prototype.set=function(b,c){if(!this.has(b)){this.length++}this.store[b]=c};a.Store.prototype.get=function(b){return this.store[b]};a.Store.prototype.has=function(b){return b in this.store};a.Store.prototype.remove=function(b){if(!this.has(b)){return}delete this.store[b];this.length--};a.Store.prototype.toJSON=function(){return{store:this.store,length:this.length}};a.stemmer=(function(){var F={ational:"ate",tional:"tion",enci:"ence",anci:"ance",izer:"ize",bli:"ble",alli:"al",entli:"ent",eli:"e",ousli:"ous",ization:"ize",ation:"ate",ator:"ate",alism:"al",iveness:"ive",fulness:"ful",ousness:"ous",aliti:"al",iviti:"ive",biliti:"ble",logi:"log"},G={icate:"ic",ative:"",alize:"al",iciti:"ic",ical:"ic",ful:"",ness:""},b="[^aeiou]",H="[aeiouy]",d=b+"[^aeiouy]*",I=H+"[aeiou]*",f="^("+d+")?"+I+d,e="^("+d+")?"+I+d+"("+I+")?$",g="^("+d+")?"+I+d+I+d,E="^("+d+")?"+H;var s=new RegExp(f);var t=new RegExp(g);var r=new RegExp(e);var u=new RegExp(E);var i=/^(.+?)(ss|i)es$/;var w=/^(.+?)([^s])s$/;var j=/^(.+?)eed$/;var x=/^(.+?)(ed|ing)$/;var k=/.$/;var y=/(at|bl|iz)$/;var A=new RegExp("([^aeiouylsz])\\1$");var D=new RegExp("^"+d+H+"[^aeiouwxy]$");var l=/^(.+?[^aeiou])y$/;var m=/^(.+?)(ational|tional|enci|anci|izer|bli|alli|entli|eli|ousli|ization|ation|ator|alism|iveness|fulness|ousness|aliti|iviti|biliti|logi)$/;var n=/^(.+?)(icate|ative|alize|iciti|ical|ful|ness)$/;var o=/^(.+?)(al|ance|ence|er|ic|able|ible|ant|ement|ment|ent|ou|ism|ate|iti|ous|ive|ize)$/;var z=/^(.+?)(s|t)(ion)$/;var p=/^(.+?)e$/;var q=/ll$/;var B=new RegExp("^"+d+H+"[^aeiouwxy]$");var h=function h(O){var M,N,c,C,J,K,L;if(O.length<3){return O}c=O.substr(0,1);if(c=="y"){O=c.toUpperCase()+O.substr(1)}C=i;J=w;if(C.test(O)){O=O.replace(C,"$1$2")}else{if(J.test(O)){O=O.replace(J,"$1$2")}}C=j;J=x;if(C.test(O)){var v=C.exec(O);C=s;if(C.test(v[1])){C=k;O=O.replace(C,"")}}else{if(J.test(O)){var v=J.exec(O);M=v[1];J=u;if(J.test(M)){O=M;J=y;K=A;L=D;if(J.test(O)){O=O+"e"}else{if(K.test(O)){C=k;O=O.replace(C,"")}else{if(L.test(O)){O=O+"e"}}}}}}C=l;if(C.test(O)){var v=C.exec(O);M=v[1];O=M+"i"}C=m;if(C.test(O)){var v=C.exec(O);M=v[1];N=v[2];C=s;if(C.test(M)){O=M+F[N]}}C=n;if(C.test(O)){var v=C.exec(O);M=v[1];N=v[2];C=s;if(C.test(M)){O=M+G[N]}}C=o;J=z;if(C.test(O)){var v=C.exec(O);M=v[1];C=t;if(C.test(M)){O=M}}else{if(J.test(O)){var v=J.exec(O);M=v[1]+v[2];J=t;if(J.test(M)){O=M}}}C=p;if(C.test(O)){var v=C.exec(O);M=v[1];C=t;J=r;K=B;if(C.test(M)||(J.test(M)&&!(K.test(M)))){O=M}}C=q;J=t;if(C.test(O)&&J.test(O)){C=k;O=O.replace(C,"")}if(c=="y"){O=c.toLowerCase()+O.substr(1)}return O};return h})();a.Pipeline.registerFunction(a.stemmer,"stemmer");a.generateStopWordFilter=function(b){var c=b.reduce(function(d,e){d[e]=e;return d},{});return function(d){if(d&&c[d]!==d){return d}}};a.stopWordFilter=a.generateStopWordFilter(["a","able","about","across","after","all","almost","also","am","among","an","and","any","are","as","at","be","because","been","but","by","can","cannot","could","dear","did","do","does","either","else","ever","every","for","from","get","got","had","has","have","he","her","hers","him","his","how","however","i","if","in","into","is","it","its","just","least","let","like","likely","may","me","might","most","must","my","neither","no","nor","not","of","off","often","on","only","or","other","our","own","rather","said","say","says","she","should","since","so","some","than","that","the","their","them","then","there","these","they","this","tis","to","too","twas","us","wants","was","we","were","what","when","where","which","while","who","whom","why","will","with","would","yet","you","your"]);a.Pipeline.registerFunction(a.stopWordFilter,"stopWordFilter");a.trimmer=function(b){return b.replace(/^\W+/,"").replace(/\W+$/,"")};a.Pipeline.registerFunction(a.trimmer,"trimmer");a.TokenStore=function(){this.root={docs:{}};this.length=0};a.TokenStore.load=function(b){var c=new this;c.root=b.root;c.length=b.length;return c};a.TokenStore.prototype.add=function(f,b,e){var e=e||this.root,c=f.charAt(0),d=f.slice(1);if(!(c in e)){e[c]={docs:{}}}if(d.length===0){e[c].docs[b.ref]=b;this.length+=1;return}else{return this.add(d,b,e[c])}};a.TokenStore.prototype.has=function(d){if(!d){return false}var c=this.root;for(var b=0;b<d.length;b++){if(!c[d.charAt(b)]){return false}c=c[d.charAt(b)]}return true};a.TokenStore.prototype.getNode=function(d){if(!d){return{}}var c=this.root;for(var b=0;b<d.length;b++){if(!c[d.charAt(b)]){return{}}c=c[d.charAt(b)]}return c};a.TokenStore.prototype.get=function(c,b){return this.getNode(c,b).docs||{}};a.TokenStore.prototype.count=function(c,b){return Object.keys(this.get(c,b)).length};a.TokenStore.prototype.remove=function(e,d){if(!e){return}var c=this.root;for(var b=0;b<e.length;b++){if(!(e.charAt(b) in c)){return}c=c[e.charAt(b)]}delete c.docs[d]};a.TokenStore.prototype.expand=function(e,c){var d=this.getNode(e),b=d.docs||{},c=c||[];if(Object.keys(b).length){c.push(e)}Object.keys(d).forEach(function(f){if(f==="docs"){return}c.concat(this.expand(e+f,c))},this);return c};a.TokenStore.prototype.toJSON=function(){return{root:this.root,length:this.length}};(function(c,b){if(typeof define==="function"&&define.amd){define(b)}else{if(typeof exports==="object"){module.exports=b()}else{c.lunr=b()}}}(this,function(){return a}))})();