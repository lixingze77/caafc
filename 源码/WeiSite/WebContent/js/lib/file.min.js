define([],function(c,a,b){function e(j){j=$.extend({file:undefined,maxFileSize:2,success:undefined,progress:undefined,error:undefined},j);var i=0;var h=$("<img>");var f=h[0];var g=j.file;var l=g.size;if((g.size/1024/1024)>j.maxFileSize){if($.isFunction(j.error)){j.error("图片大小不能超过"+j.maxFileSize+"M")}return}var k=new FileReader();k.onload=function(){var m=k.result;f.src=m};k.onprogress=function(m){if($.isFunction(j.progress)){j.progress(m)}};k.onerror=function(){};k.readAsDataURL(g);f.onload=function(){var r=f.width,p=f.height,q=r/p;r=parseInt(400);p=parseInt(r/q);var m=$("<canvas></canvas>");var o=m[0].getContext("2d");m.attr({width:r,height:p});o.drawImage(f,0,0,r,p);var n=m[0].toDataURL("image/jpeg",0.5);if($.isFunction(j.success)){j.success(n,f)}}}function d(f,g){$.ajax({url:"../hf/file/base64",type:"post",data:{picdata:encodeURIComponent(f)},dataType:"json",success:function(h){if($.isFunction(g)){g(h)}}})}return{uploadImgBase64:e,upload:d}});