window.LArea=(function(){var a=function(){this.gearArea;this.data;this.index=0;this.value=[0,0,0]};a.prototype={init:function(b){this.params=b;this.trigger=document.querySelector(b.trigger);if(b.valueTo){this.valueTo=document.querySelector(b.valueTo)}this.keys=b.keys;this.type=b.type||1;switch(this.type){case 1:case 2:break;default:throw new Error("错误提示: 没有这种数据源类型");break}this.bindEvent()},getData:function(c){var b=this;if(typeof b.params.data=="object"){b.data=b.params.data;c()}else{var d=new XMLHttpRequest();d.open("get",b.params.data);d.onload=function(f){if((d.status>=200&&d.status<300)||d.status===0){var g=JSON.parse(d.responseText);b.data=g.data;if(c){c()}}};d.send()}},bindEvent:function(){var b=this;function g(m){b.gearArea=document.createElement("div");b.gearArea.className="gearArea";b.gearArea.innerHTML='<div class="area_ctrl slideInUp"><div class="area_btn_box"><div class="area_btn larea_cancel">取消</div><div class="area_btn larea_finish">确定</div></div><div class="area_roll_mask"><div class="area_roll"><div><div class="gear area_province" data-areatype="area_province"></div><div class="area_grid"></div></div><div><div class="gear area_city" data-areatype="area_city"></div><div class="area_grid"></div></div><div><div class="gear area_county" data-areatype="area_county"></div><div class="area_grid"></div></div></div></div></div>';document.body.appendChild(b.gearArea);c();var n=b.gearArea.querySelector(".larea_cancel");n.addEventListener("touchstart",function(p){b.close(p)});var o=b.gearArea.querySelector(".larea_finish");o.addEventListener("touchstart",function(p){b.finish(p)});var l=b.gearArea.querySelector(".area_province");var j=b.gearArea.querySelector(".area_city");var k=b.gearArea.querySelector(".area_county");l.addEventListener("touchstart",f);j.addEventListener("touchstart",f);k.addEventListener("touchstart",f);l.addEventListener("touchmove",e);j.addEventListener("touchmove",e);k.addEventListener("touchmove",e);l.addEventListener("touchend",d);j.addEventListener("touchend",d);k.addEventListener("touchend",d)}function c(){b.gearArea.querySelector(".area_province").setAttribute("val",b.value[0]);b.gearArea.querySelector(".area_city").setAttribute("val",b.value[1]);b.gearArea.querySelector(".area_county").setAttribute("val",b.value[2]);switch(b.type){case 1:b.setGearTooth(b.data);break;case 2:b.setGearTooth(b.data[0]);break}}function f(j){j.preventDefault();var k=j.target;while(true){if(!k.classList.contains("gear")){k=k.parentElement}else{break}}clearInterval(k["int_"+k.id]);k["old_"+k.id]=j.targetTouches[0].screenY;k["o_t_"+k.id]=(new Date()).getTime();var l=k.getAttribute("top");if(l){k["o_d_"+k.id]=parseFloat(l.replace(/em/g,""))}else{k["o_d_"+k.id]=0}k.style.webkitTransitionDuration=k.style.transitionDuration="0ms"}function e(j){j.preventDefault();var l=j.target;while(true){if(!l.classList.contains("gear")){l=l.parentElement}else{break}}l["new_"+l.id]=j.targetTouches[0].screenY;l["n_t_"+l.id]=(new Date()).getTime();var k=(l["new_"+l.id]-l["old_"+l.id])*30/window.innerHeight;l["pos_"+l.id]=l["o_d_"+l.id]+k;l.style["-webkit-transform"]="translate3d(0,"+l["pos_"+l.id]+"em,0)";l.setAttribute("top",l["pos_"+l.id]+"em");if(j.targetTouches[0].screenY<1){d(j)}}function d(j){j.preventDefault();var l=j.target;while(true){if(!l.classList.contains("gear")){l=l.parentElement}else{break}}var k=(l["new_"+l.id]-l["old_"+l.id])/(l["n_t_"+l.id]-l["o_t_"+l.id]);if(Math.abs(k)<=0.2){l["spd_"+l.id]=(k<0?-0.08:0.08)}else{if(Math.abs(k)<=0.5){l["spd_"+l.id]=(k<0?-0.16:0.16)}else{l["spd_"+l.id]=k/2}}if(!l["pos_"+l.id]){l["pos_"+l.id]=0}h(l)}function h(m){var j=0;var l=false;function k(){m.style.webkitTransitionDuration=m.style.transitionDuration="200ms";l=true}clearInterval(m["int_"+m.id]);m["int_"+m.id]=setInterval(function(){var q=m["pos_"+m.id];var r=m["spd_"+m.id]*Math.exp(-0.03*j);q+=r;if(Math.abs(r)>0.1){}else{var n=Math.round(q/2)*2;q=n;k()}if(q>0){q=0;k()}var p=-(m.dataset.len-1)*2;if(q<p){q=p;k()}if(l){var o=Math.abs(q)/2;if(!isNaN(o)){i(m,o);clearInterval(m["int_"+m.id])}}m["pos_"+m.id]=q;m.style["-webkit-transform"]="translate3d(0,"+q+"em,0)";m.setAttribute("top",q+"em");j++},30)}function i(n,o){o=Math.round(o);n.setAttribute("val",o);switch(b.type){case 1:b.setGearTooth(b.data);break;case 2:switch(n.dataset.areatype){case"area_province":b.setGearTooth(b.data[0]);break;case"area_city":var m=n.childNodes[o].getAttribute("ref");var j=[];var l=b.data[2];for(var k in l){if(k==m){j=l[k];break}}b.index=2;b.setGearTooth(j);break}}}b.getData(function(){$(b.trigger).on("tap",g)})},setGearTooth:function(d){var b=this;var j=d||[];var m=j.length;var e=b.gearArea.querySelectorAll(".gear");var f=e[b.index].getAttribute("val");var n=m-1;if(f>n){f=n}e[b.index].setAttribute("data-len",m);if(m>0){var h=j[f][this.keys.id];var c;switch(b.type){case 1:c=j[f].child;break;case 2:var o=b.data[b.index+1];for(var g in o){if(g==h){c=o[g];break}}break}var k="";for(var g=0;g<m;g++){k+="<div class='tooth'  ref='"+j[g][this.keys.id]+"'>"+j[g][this.keys.name]+"</div>"}e[b.index].innerHTML=k;e[b.index].style["-webkit-transform"]="translate3d(0,"+(-f*2)+"em,0)";e[b.index].setAttribute("top",-f*2+"em");e[b.index].setAttribute("val",f);b.index++;if(b.index>2){b.index=0;return}b.setGearTooth(c)}else{e[b.index].innerHTML="<div class='tooth'></div>";e[b.index].setAttribute("val",0);if(b.index==1){e[2].innerHTML="<div class='tooth'></div>";e[2].setAttribute("val",0)}b.index=0}},finish:function(m){var b=this;var f=b.gearArea.querySelector(".area_province");var c=b.gearArea.querySelector(".area_city");var d=b.gearArea.querySelector(".area_county");var p=parseInt(f.getAttribute("val"));var o=f.childNodes[p].textContent;var n=f.childNodes[p].getAttribute("ref");var i=parseInt(c.getAttribute("val"));var h=c.childNodes[i].textContent;var g=c.childNodes[i].getAttribute("ref");var l=parseInt(d.getAttribute("val"));var k=d.childNodes[l].textContent;var j=d.childNodes[l].getAttribute("ref");b.trigger.value=o+((h)?(","+h):(""))+((k)?(","+k):(""));b.value=[p,i,l];if(this.valueTo){this.valueTo.value=n+((g)?(","+g):(""))+((j)?(","+j):(""))}b.close(m)},close:function(c){c.preventDefault();var b=this;var d=new CustomEvent("input");b.trigger.dispatchEvent(d);document.body.removeChild(b.gearArea);b.gearArea=null}};return a})();